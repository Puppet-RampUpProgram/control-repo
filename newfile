osVer=$(facter -p os.family)

if [ $(find -name $(echo " $(ls /opt/puppetlabs/server/data/packages/public/current/$(facter -p platform_tag)*/ | grep rpm)")) ]
then
#rhel
if [ "$osVer" == "RedHat" ] 
then
  echo "exclude=puppet-agent" >> /etc/yum.conf
  rpm -iUv --oldpackage $(find -name $(echo " $(ls /opt/puppetlabs/server/data/packages/public/current/$(facter -p platform_tag)*/ | grep rpm)"))
  puppet agent -t
#debian
elif [ "$osVer" == "Debian" ] 
then
  sudo apt-mark hold puppet-agent
  rpm -iUv --oldpackage $(find -name $(echo " $(ls /opt/puppetlabs/server/data/packages/public/current/$(facter -p platform_tag)*/ | grep rpm)"))
  puppet agent -t
else
  echo "Not a Supported os for this task."
fi